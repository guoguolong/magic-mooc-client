(this["webpackJsonpmagic-mooc"]=this["webpackJsonpmagic-mooc"]||[]).push([[1],{393:function(e,t,a){e.exports=a(399)},395:function(e,t,a){},396:function(e,t,a){},399:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(46),u=a.n(c),s=a(12),i=a(42),o=(a(83),a(7)),m=a.n(o),l=a(16),p=a(40),d=a(33),f=a(66),b=a(115),v=a(30),E=a(65),y=a(26),h=a.n(y),w=a(48);function j(){var e=Object(v.a)(["\n            mutation ($id: Int!){\n                remove (id: $id){\n                    error, message\n                }\n            }\n        "]);return j=function(){return e},e}function O(){var e=Object(v.a)(["\n                    query($pageNo: Int){\n                        list (pageNo: $pageNo){\n                            id,name,price,summary\n                        }\n                    }\n                "]);return O=function(){return e},e}function g(){var e=Object(v.a)(["\n                mutation($data: CourseInputType!){\n                    save (data: $data){\n                        id, name, summary, price\n                    }\n                }\n            "]);return g=function(){return e},e}function x(){var e=Object(v.a)(["\n            query($pageNo: Int){\n                list (pageNo: $pageNo){\n                    id,name,price,summary\n                }\n            }\n        "]);return x=function(){return e},e}function N(){var e=Object(v.a)(["\n            query($id: Int!){\n                detail (id: $id){\n                    id,name,price,summary\n                }\n            }\n        "]);return N=function(){return e},e}var k=new E.a({uri:w.a.baseApiUrl+"course"});function C(){return(C=Object(l.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t/=1,e.next=3,k.query({query:h()(N()),variables:{id:t}});case 3:return a=e.sent,e.abrupt("return",a.data.detail);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(l.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.query({query:h()(x())});case 2:return t=e.sent,e.abrupt("return",t.data.list);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return($=Object(l.a)(m.a.mark((function e(t,a){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1,(n=Object(b.a)({},t)).price=n.price/1,e.prev=3,e.next=6,k.mutate({mutation:h()(g()),variables:{data:n},update:function(e,t){var a=t.data,n=h()(O());try{var r=e.readQuery({query:n}).list;r.push(a),e.writeQuery({query:n,data:{list:r}})}catch(c){}}});case 6:return r=e.sent,e.abrupt("return",r.data.save);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{error:10,message:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function I(){return(I=Object(l.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t/=1,e.next=3,k.mutate({mutation:h()(j()),variables:{id:t}});case 3:return a=e.sent,e.abrupt("return",a.data.remove);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S={getCourseDetail:function(e){return C.apply(this,arguments)},getCourseList:function(){return q.apply(this,arguments)},saveCourse:function(e,t){return $.apply(this,arguments)},deleteCourse:function(e){return I.apply(this,arguments)}},L=(a(395),function(){var e=Object(n.useState)({name:"",id:0,summary:"",price:0}),t=Object(p.a)(e,2),a=t[0],c=t[1],u=Object(n.useState)(!1),o=Object(p.a)(u,2),b=o[0],v=o[1],E=Object(n.useState)(""),y=Object(p.a)(E,2),h=y[0],w=y[1],j=Object(i.h)().courseId;return j=j||0,Object(n.useEffect)((function(){Object(l.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.getCourseDetail(j);case 2:(t=e.sent)&&c(t);case 4:case"end":return e.stop()}}),e)})))()}),[j]),r.a.createElement("div",{className:"form-container"},r.a.createElement("h1",null,"Course Edit"),r.a.createElement(s.b,{to:"/admin"},"Back to list"),r.a.createElement(d.d,{enableReinitialize:!0,initialValues:{name:a.name,id:a.id,summary:a.summary,price:a.price},validationSchema:f.a({name:f.b().max(30,"Must be 30 characters or less").required("Title can not be empty"),summary:f.b().max(500,"Must be 500 characters or less").required("Summary can not be empty"),price:f.b().required("Required")}),onSubmit:function(){var e=Object(l.a)(m.a.mark((function e(t,a){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.setSubmitting,e.next=3,S.saveCourse(t,j);case 3:(n=e.sent).error?w(n.message):(c(n),v(!0));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},r.a.createElement(d.c,{className:"course-form form"},b&&r.a.createElement(i.a,{to:"/admin"}),h&&r.a.createElement("div",{className:"error"},h),r.a.createElement("div",{className:"row"},r.a.createElement("label",{htmlFor:"name"},"Title: "),r.a.createElement(d.b,{name:"name",type:"text"}),r.a.createElement(d.a,{name:"name"})),r.a.createElement("div",{className:"row"},r.a.createElement("label",{htmlFor:"summary"},"Intro: "),r.a.createElement(d.b,{name:"summary",as:"textarea"}),r.a.createElement(d.a,{name:"summary"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"price"},"Price: "),r.a.createElement(d.b,{name:"price",type:"text"})),r.a.createElement("div",null,r.a.createElement(d.a,{name:"price"}))),r.a.createElement("div",{className:"row center"},r.a.createElement("button",{type:"submit"},"Save")))))});a(396);function T(e){var t=e.item,a=e.updateCourses;return r.a.createElement("li",null,r.a.createElement("span",null,t.id),r.a.createElement("span",null,r.a.createElement(s.b,{to:"/admin/course/"+t.id},t.name)),r.a.createElement("span",null,"\xa5",t.price),r.a.createElement("span",{className:"summary",title:t.summary},t.summary),r.a.createElement("span",{className:"button",onClick:Object(l.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.deleteCourse(t.id);case 2:e.sent.error||a(t.id);case 4:case"end":return e.stop()}}),e)})))},"[DELETE]"))}var B=function(){var e=Object(n.useState)([]),t=Object(p.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){Object(l.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){var n=(a=a.filter((function(t){return t.id!==e}))).map((function(e){return r.a.createElement(T,{key:e.id,item:e,updateCourses:t})}));c(n)},e.next=3,S.getCourseList();case 3:a=e.sent,n=a.map((function(e){return r.a.createElement(T,{key:e.id,item:e,updateCourses:t})})),c(n);case 6:case"end":return e.stop()}}),e)})))()}),[]),r.a.createElement("div",{className:"course-list"},r.a.createElement("h1",null,"Course List"),r.a.createElement(s.b,{to:"/admin/course"},"New Course"),r.a.createElement("ul",null,a))},D=a(61);u.a.render(r.a.createElement(s.a,null,r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/admin/course/:courseId(\\d+)?"},r.a.createElement(L,null)),r.a.createElement(i.b,{path:"/admin"},r.a.createElement(B,null)))),document.getElementById("root")),D.a()},48:function(e,t,a){"use strict";t.a={baseApiUrl:"https://mooc-api.banyuan.club/"}},61:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function n(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},83:function(e,t,a){}},[[393,3,0,6]]]);
//# sourceMappingURL=admin.1d0c3f28.b9366e7a.chunk.js.map