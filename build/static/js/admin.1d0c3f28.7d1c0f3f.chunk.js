(this["webpackJsonpmagic-mooc"]=this["webpackJsonpmagic-mooc"]||[]).push([[1],{27:function(e,n,a){"use strict";var i=a(78),t=a(4),r=a.n(t),d=a(9),s=a(76),u="https://mooc-api.banyuan.club/",c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pageNo"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"course"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"list"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pageNo"},value:{kind:"Variable",name:{kind:"Name",value:"pageNo"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:119,source:{body:"query ($pageNo: Int){\n    course {\n        list (pageNo: $pageNo){\n            id,name,price,summary\n        }\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}}}},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"course"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"detail"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:109,source:{body:"query ($id: Int!){\n    course {\n        detail (id: $id){\n            id,name,price,summary\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}}}},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CourseSummary"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"courseId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"course"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"courseId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"start_article_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"activeArticle"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"articles"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"seq"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"level"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"children"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"seq"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"level"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"children"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"seq"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"level"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:448,source:{body:"query CourseSummary($courseId: Int!){\n    course {\n        summary (id: $courseId) {\n            id,name,summary,start_article_id,activeArticle{\n                    id,name,content\n                },articles {\n                id,name,seq, parent_id,level,children {\n                    id,name,seq,parent_id,level,children {\n                        id,name,seq,parent_id,level\n                    }\n                }\n            }\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}}}},o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CourseInputType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"course"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"save"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:131,source:{body:"mutation ($data: CourseInputType!){\n    course {\n        save (data: $data){\n            id, name, summary, price\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}}}},v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CourseRemove"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"course"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"remove"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:117,source:{body:"mutation CourseRemove($id: Int!){\n    course {\n        remove (id: $id){\n            error, message\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}}}},k={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ArticleDetail"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"article"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"detail"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:117,source:{body:"query ArticleDetail($id: Int!){\n    article {\n        detail (id: $id){\n            id,name,content\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}}}};function p(){return new s.a({uri:u+"graphql"})}function N(){return(N=Object(d.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n/=1,e.next=3,p().query({query:l,variables:{id:n}});case 3:return a=e.sent,e.abrupt("return",a.data.course.detail);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=Object(d.a)(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().query({query:c});case 2:return n=e.sent,e.abrupt("return",n.data.course.list);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(d.a)(r.a.mark((function e(n,a){var t,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1,(t=Object(i.a)({},n)).price=t.price/1,e.prev=3,e.next=6,p().mutate({mutation:o,variables:{data:t},update:function(e,n){var a=n.data;try{var i=e.readQuery({query:c}).list;i.push(a),e.writeQuery({query:c,data:{list:i}})}catch(t){}}});case 6:return d=e.sent,e.abrupt("return",d.data.course.save);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{error:10,message:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function b(){return(b=Object(d.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n/=1,e.next=3,p().mutate({mutation:v,variables:{id:n}});case 3:return a=e.sent,e.abrupt("return",a.data.course.remove);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=Object(d.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n/=1,e.next=3,p().query({query:m,variables:{courseId:n}});case 3:return a=e.sent,e.abrupt("return",a.data.course.summary);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(d.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n/=1,e.next=3,p().query({query:k,variables:{id:n}});case 3:return a=e.sent,e.abrupt("return",a.data.article.detail);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.a={getCourseDetail:function(e){return N.apply(this,arguments)},getCourseList:function(){return f.apply(this,arguments)},getCourseSummary:function(e){return g.apply(this,arguments)},saveCourse:function(e,n){return y.apply(this,arguments)},deleteCourse:function(e){return b.apply(this,arguments)},fetchArticle:function(e){return S.apply(this,arguments)}}},392:function(e,n,a){e.exports=a(398)},394:function(e,n,a){},395:function(e,n,a){},398:function(e,n,a){"use strict";a.r(n);var i=a(0),t=a.n(i),r=a(45),d=a.n(r),s=a(13),u=a(41),c=(a(82),a(4)),l=a.n(c),m=a(9),o=a(39),v=a(32),k=a(63),p=a(27),N=(a(394),function(){var e=Object(i.useState)({name:"",id:0,summary:"",price:0}),n=Object(o.a)(e,2),a=n[0],r=n[1],d=Object(i.useState)(!1),c=Object(o.a)(d,2),N=c[0],f=c[1],y=Object(i.useState)(""),b=Object(o.a)(y,2),g=b[0],S=b[1],h=Object(u.h)().courseId;return h=h||0,Object(i.useEffect)((function(){Object(m.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getCourseDetail(h);case 2:(n=e.sent)&&r(n);case 4:case"end":return e.stop()}}),e)})))()}),[h]),t.a.createElement("div",{className:"form-container"},t.a.createElement("h1",null,"Course Edit"),t.a.createElement(s.b,{to:"/admin"},"Back to list"),t.a.createElement(v.d,{enableReinitialize:!0,initialValues:{name:a.name,id:a.id,summary:a.summary,price:a.price},validationSchema:k.a({name:k.b().max(30,"Must be 30 characters or less").required("Title can not be empty"),summary:k.b().max(500,"Must be 500 characters or less").required("Summary can not be empty"),price:k.b().required("Required")}),onSubmit:function(){var e=Object(m.a)(l.a.mark((function e(n,a){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.setSubmitting,e.next=3,p.a.saveCourse(n,h);case 3:(i=e.sent).error?S(i.message):(r(i),f(!0));case 5:case"end":return e.stop()}}),e)})));return function(n,a){return e.apply(this,arguments)}}()},t.a.createElement(v.c,{className:"course-form form"},N&&t.a.createElement(u.a,{to:"/admin"}),g&&t.a.createElement("div",{className:"error"},g),t.a.createElement("div",{className:"row"},t.a.createElement("label",{htmlFor:"name"},"Title: "),t.a.createElement(v.b,{name:"name",type:"text"}),t.a.createElement(v.a,{name:"name"})),t.a.createElement("div",{className:"row"},t.a.createElement("label",{htmlFor:"summary"},"Intro: "),t.a.createElement(v.b,{name:"summary",as:"textarea"}),t.a.createElement(v.a,{name:"summary"})),t.a.createElement("div",{className:"row"},t.a.createElement("div",null,t.a.createElement("label",{htmlFor:"price"},"Price: "),t.a.createElement(v.b,{name:"price",type:"text"})),t.a.createElement("div",null,t.a.createElement(v.a,{name:"price"}))),t.a.createElement("div",{className:"row center"},t.a.createElement("button",{type:"submit"},"Save")))))});a(395);function f(e){var n=e.item,a=e.updateCourses;return t.a.createElement("li",null,t.a.createElement("span",null,n.id),t.a.createElement("span",null,t.a.createElement(s.b,{to:"/admin/course/"+n.id},n.name)),t.a.createElement("span",null,"\xa5",n.price),t.a.createElement("span",{className:"summary",title:n.summary},n.summary),t.a.createElement("span",{className:"button",onClick:Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.deleteCourse(n.id);case 2:e.sent.error||a(n.id);case 4:case"end":return e.stop()}}),e)})))},"[DELETE]"))}var y=function(){var e=Object(i.useState)([]),n=Object(o.a)(e,2),a=n[0],r=n[1];return Object(i.useEffect)((function(){Object(m.a)(l.a.mark((function e(){var n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){var i=(a=a.filter((function(n){return n.id!==e}))).map((function(e){return t.a.createElement(f,{key:e.id,item:e,updateCourses:n})}));r(i)},e.next=3,p.a.getCourseList();case 3:a=e.sent,i=a.map((function(e){return t.a.createElement(f,{key:e.id,item:e,updateCourses:n})})),r(i);case 6:case"end":return e.stop()}}),e)})))()}),[]),t.a.createElement("div",{className:"course-list"},t.a.createElement("h1",null,"Course List"),t.a.createElement(s.b,{to:"/admin/course"},"New Course"),t.a.createElement("ul",null,a))},b=a(59);d.a.render(t.a.createElement(s.a,null,t.a.createElement(u.d,null,t.a.createElement(u.b,{path:"/admin/course/:courseId(\\d+)?"},t.a.createElement(N,null)),t.a.createElement(u.b,{path:"/admin"},t.a.createElement(y,null)))),document.getElementById("root")),b.a()},59:function(e,n,a){"use strict";a.d(n,"a",(function(){return i}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function i(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},82:function(e,n,a){}},[[392,3,0,6]]]);
//# sourceMappingURL=admin.1d0c3f28.7d1c0f3f.chunk.js.map