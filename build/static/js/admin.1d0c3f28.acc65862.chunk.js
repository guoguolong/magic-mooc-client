(this["webpackJsonpmagic-mooc"]=this["webpackJsonpmagic-mooc"]||[]).push([[1],{12:function(e,n,t){"use strict";t.d(n,"c",(function(){return d})),t.d(n,"b",(function(){return b})),t.d(n,"f",(function(){return p})),t.d(n,"e",(function(){return f})),t.d(n,"d",(function(){return v})),t.d(n,"a",(function(){return E}));var a=t(15),r=t(16),c=t.n(r);function i(){var e=Object(a.a)(["\n    query ArticleDetail($id: Int!){\n        article {\n            detail (id: $id){\n                id,name,content\n            }\n        }\n    }\n"]);return i=function(){return e},e}function u(){var e=Object(a.a)(["\n    mutation CourseRemove($id: Int!){\n        course {\n            remove (id: $id){\n                error, message\n            }\n        }\n    }\n"]);return u=function(){return e},e}function o(){var e=Object(a.a)(["\n    mutation ($data: CourseInputType!){\n        course {\n            save (data: $data){\n                id, name, summary, price\n            }\n        }\n    }\n"]);return o=function(){return e},e}function s(){var e=Object(a.a)(["\n    query CourseSummary($courseId: Int!){\n        course {\n            summary (id: $courseId) {\n                id,name,summary,start_article_id,\n                activeArticle{\n                    id,name,content\n                },\n                articles {\n                    is_open @client, is_active @client, id,name,seq, parent_id,level,children {\n                        is_open @client, is_active @client, id,name,seq,parent_id,level,children {\n                            is_open @client, is_active @client, id,name,seq,parent_id,level\n                        }\n                    }\n                }\n            }\n        }\n    }\n"]);return s=function(){return e},e}function l(){var e=Object(a.a)(["\n    query ($id: Int!){\n        course {\n            detail (id: $id){\n                id,name,price,summary\n            }\n        }\n    }\n"]);return l=function(){return e},e}function m(){var e=Object(a.a)(["\n    query ($pageNo: Int){\n        course {\n            list (pageNo: $pageNo){\n                id,name,price,summary\n            }\n        }\n    }\n"]);return m=function(){return e},e}var d=c()(m()),b=c()(l()),p=c()(s()),f=c()(o()),v=c()(u()),E=c()(i())},398:function(e,n,t){e.exports=t(405)},401:function(e,n,t){},402:function(e,n,t){},405:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(51),i=t.n(c),u=t(20),o=t(46),s=t(32),l=t(86),m=t(85),d=t(14),b=t(47),p=t.n(b),f=t(70),v=t(19),E=t(38),y=t(72),h=t(17),O=t(12),j=(t(401),function(){var e,n=Object(a.useState)({name:"",id:0,summary:"",price:0}),t=Object(v.a)(n,2),c=t[0],i=t[1],s=Object(a.useState)(!1),l=Object(v.a)(s,2),m=l[0],d=l[1],b=Object(a.useState)(""),j=Object(v.a)(b,2),w=j[0],g=j[1],N=Object(o.h)().courseId;(N/=1)&&(e=Object(h.b)(O.b,{variables:{id:N}}));var q=Object(h.a)(O.e),$=Object(v.a)(q,2),k=$[0],I=$[1];I.loading,I.error;return Object(a.useEffect)((function(){e&&e.data&&i(e.data.course.detail)}),[e]),r.a.createElement("div",{className:"form-container"},r.a.createElement("h1",null,"Course Edit"),r.a.createElement(u.b,{to:"/admin"},"[Back to list]"),r.a.createElement(E.d,{enableReinitialize:!0,initialValues:{name:c.name,id:c.id,summary:c.summary,price:c.price},validationSchema:y.a({name:y.b().max(30,"Must be 30 characters or less").required("Title can not be empty"),summary:y.b().max(500,"Must be 500 characters or less").required("Summary can not be empty"),price:y.b().required("Required")}),onSubmit:function(){var e=Object(f.a)(p.a.mark((function e(n,t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setSubmitting,n.price/=1,e.prev=2,e.next=5,k({variables:{data:n},update:function(e,n){var t=n.data;try{var a=e.readQuery({query:O.c}).course;e.writeQuery({query:O.c,data:{course:a.list.concat([t.course.save])}})}catch(r){}d(!0)}});case 5:e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),g(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(n,t){return e.apply(this,arguments)}}()},r.a.createElement(E.c,{className:"course-form form"},m&&r.a.createElement(o.a,{to:"/admin"}),w&&r.a.createElement("div",{className:"error"},w),r.a.createElement("div",{className:"row"},r.a.createElement("label",{htmlFor:"name"},"Title: "),r.a.createElement(E.b,{name:"name",type:"text"}),r.a.createElement(E.a,{name:"name"})),r.a.createElement("div",{className:"row"},r.a.createElement("label",{htmlFor:"summary"},"Intro: "),r.a.createElement(E.b,{name:"summary",as:"textarea"}),r.a.createElement(E.a,{name:"summary"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"price"},"Price: "),r.a.createElement(E.b,{name:"price",type:"text"})),r.a.createElement("div",null,r.a.createElement(E.a,{name:"price"}))),r.a.createElement("div",{className:"row center"},r.a.createElement("button",{type:"submit"},"Save")))))});t(402);function w(e){var n=e.item,t=Object(h.a)(O.d,{variables:{id:n.id},refetchQueries:[{query:O.c}]}),a=Object(v.a)(t,2),c=a[0],i=a[1];i.loading,i.error;return r.a.createElement("li",null,r.a.createElement("span",null,n.id),r.a.createElement("span",null,r.a.createElement(u.b,{to:"/admin/course/"+n.id},n.name)),r.a.createElement("span",null,"\xa5",n.price),r.a.createElement("span",{className:"summary",title:n.summary},n.summary),r.a.createElement("span",{className:"button",onClick:Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c());case 1:case"end":return e.stop()}}),e)})))},"[DELETE]"))}var g=function(){var e=Object(a.useState)([]),n=Object(v.a)(e,2),t=n[0],c=n[1],i=Object(h.b)(O.c),o=i.data,s=i.loading,l=i.error;return Object(a.useEffect)((function(){Object(f.a)(p.a.mark((function e(){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o&&o.course&&o.course.list&&(n=o.course.list.map((function(e){return r.a.createElement(w,{key:e.id,item:e})})),c(n));case 1:case"end":return e.stop()}}),e)})))()}),[o]),s?r.a.createElement("p",{className:"loading"},"Loading..."):l?r.a.createElement("p",null,"ERROR: ",l.message):r.a.createElement("div",{className:"course-list"},r.a.createElement("h1",null,"Course List"),r.a.createElement(u.b,{to:"/admin/course"},"[New Course]"),r.a.createElement("ul",null,t))},N=t(66),q=t(67),$=(t(94),new l.a),k=new s.a({cache:$,link:new m.a({uri:N.a.baseApiUrl,headers:{"client-name":"Magic Mooc Admin[web]","client-version":"1.0.0"}})});i.a.render(r.a.createElement(d.a,{client:k},r.a.createElement(u.a,null,r.a.createElement(o.d,null,r.a.createElement(o.b,{path:"/admin/course/:courseId(\\d+)?"},r.a.createElement(j,null)),r.a.createElement(o.b,{path:"/admin"},r.a.createElement(g,null))))),document.getElementById("root")),q.a()},66:function(e,n,t){"use strict";n.a={baseApiUrl:"https://mooc-api.banyuan.club/"}},67:function(e,n,t){"use strict";t.d(n,"a",(function(){return a}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function a(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},94:function(e,n,t){}},[[398,3,0,6]]]);
//# sourceMappingURL=admin.1d0c3f28.acc65862.chunk.js.map